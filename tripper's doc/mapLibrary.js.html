<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mapLibrary.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mapLibrary.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @name TILE_LAYER_URL
 * @description store the URL template of the tile layer of the map
 * @type {string}
 *
 */
// Constant for OpenStreetMap tile layer URL
const TILE_LAYER_URL = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';

/**
 * @name NOMINATIM_API_URL
 * @description store the URL to nominatim's API , used to get the coordinates of searched city
 * @type {string}
 */
// Constant for Nominatim API base URL
const NOMINATIM_API_URL = 'https://nominatim.openstreetmap.org/search?format=json&amp;q=';

/**
 * @name OVERPASS_API_URL
 * @description URL used to query the places to visit
 * @type {string}
 */
// Constant for Overpass API base URL
const OVERPASS_API_URL = 'https://maps.mail.ru/osm/tools/overpass/api/interpreter?data=';


/* Function to retrieve the user's current position using the Geolocation API
  ------ never used but always useful

function fetchUserPosition() {
    return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(
            // Resolve the promise with the user's coordinates if successfully retrieved
            position => resolve([position.coords.latitude, position.coords.longitude]),
            // Reject the promise with an error if there's an issue retrieving the position
            error => {
                console.log("Unable to get user coordinates");
                reject(error);
            }
        );
    });
}
*/


/**
 * @function
 * @name loadMap
 * @description load the map using TILE_LAYER_URL and center the map
 *              at choose latitude and longitude and zoom value
 *
 * @param {Object} map - see [leafleatjs doc]{@link https://leafletjs.com/reference.html#map}
 * @param lat - latitude value
 * @param lon - longitude value
 * @param zoom - zoom value
 */
function loadMap(map, lat, lon, zoom) {

    // Create the map and set the initial zoom to the specified lat,lon
    map.setView({lat,lon}, zoom);

    // Add an OpenStreetMap tile layer to the map
    L.tileLayer(TILE_LAYER_URL, {
        maxZoom: 19, // Set the maximum zoom level
        attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright">OpenStreetMap&lt;/a>', // Set the attribution
        // Set user-agent for the request
        headers: {
            'User-Agent': 'Tripper'
        }
    }).addTo(map); // Add the tile layer to the map
}

/**
 * @typedef {Object} place
 * @property {string} name - place's name
 * @property {number} latitude - place's latitude
 * @property {number} longitude - place's longitude
 * @property {string} website - URL of the website's place
 * @property {string} type - describe the type of the place (museum, restaurant etc...)
 * @property {string} [cuisine] - if the  place is a restaurant or a fast food describe the cuisine type
 */

/**
 * @function
 * @name addPlaceMaker
 * @description this function add a mark on the target map.
 *              This marker represent the place information
 *              put in input. The added marker has a popup
 *              element bound that contain the place's
 *              information. That popup open with the
 *              mouseover.
 *
 * @param {Object} map - map target , where add the marker see [leafleatjs doc]{@link https://leafletjs.com/reference.html#map}
 * @param place - the place to put on the target map
 */
function addPlaceMarker(map, place) {
    // Create a marker at the specified coordinates
    let newMarker = L.marker([place.latitude, place.longitude]).addTo(map);

    // Popup information with name and website
    let popupContent = `&lt;b>${place.name}&lt;/b>`;

    //check if the place have a website
    if (place.website &amp;&amp; place.website !== 'N/A') {
        //if place have website add the website in the popup of the marker
        popupContent += `&lt;br/>&lt;a href="${place.website}" target="_blank">${place.website}&lt;/a>`;

        //all the restaurant and fast food fetched have a website (see fetchTouristPlaces) for business logic
        if (place.type === "restaurant" || place.type === "fast_food") {
            //add the type of cuisine in the popup of the marker
            popupContent += `&lt;br/>&lt;a>Cuisine type: ${place.cuisine}&lt;/a>`;
        }

    }
    //bind marker to popup
    newMarker.bindPopup(popupContent).openPopup();

    // Bind the popup to open on mouseover
    newMarker.on('mouseover', function () {
        this.openPopup();
    });
}

/**
 * @function
 * @name removeMarkers
 * @description this function remove all
 *              markers on the target map.
 *
 * @param {Object} map - the target map where remove the markers,  see [leafleatjs doc]{@link https://leafletjs.com/reference.html#map}
 */
function removeMarkers(map) {
    map.eachLayer(function(layer) {
        if (layer instanceof L.Marker) {
            map.removeLayer(layer);
        }
    });
}

/**
 * @typedef {Object} PlaceCoordinates
 * @property {string} lat - The latitude of the location
 * @property {string} lon - The longitude of the location
 */

/**
 * @function
 * @name fetchNominatim
 * @description this function use NOMINATIM_API_URL to do a http request
 *              to nominatim server, the request if succeeded return a
 *              promise with the coordinates of searched place.
 *
 * @param {String} placeToSearch - the name of the place to search
 * @returns {Promise&lt;PlaceCoordinates>} coordinates of the searched place
 * @throws {Error} If the request to the Nominatim API fails or if there's an error parsing the response.
 * @throws {string} If no results are found for the specified place.
 */
function fetchNominatim(placeToSearch) {
    return new Promise((resolve, reject) => {
        // Construct the URL for the request using the given location name
        const url = `${NOMINATIM_API_URL}${placeToSearch}`;

        // Use the Fetch API to make an HTTP request to the Nominatim API
        fetch(url)
            .then(response => {
                // Check if the response status is OK (status code 200)
                if (!response.ok) {
                    // If not OK, reject the promise with an error message
                    throw new Error(`Request error: ${response.statusText}`);
                }
                // Parse the JSON response
                return response.json();
            })
            .then(data => {
                // Check if there are any results in the response
                if (data.length > 0) {
                    // Extract latitude and longitude from the response and update placeCoordinates array
                    const placeCoordinates = {lat:data[0].lat, lon:data[0].lon};
                    // Resolve the promise with the updated placeCoordinates array
                    resolve(placeCoordinates);
                } else {
                    // If no results found, log a message and reject the promise with an error message
                    console.log(`No results found for ${placeToSearch}`);
                    reject(`No results found for ${placeToSearch}`);
                }
            })
            .catch(error => {
                // If there's an error during the request or parsing the response, log an error message
                console.error(`Error during request: ${error.message}`);
                // Reject the promise with the error message
                reject(new Error(`Error during request: ${error.message}`));
            });
    });
}

/**
 * @function
 * @name fetchSuggestedPLaces
 * @description this function do a http request to Overpass turbo using
 *              OVERPASS_API_URL and pass to him an overpass ql query
 *              to return an array with the suggested place.
 *
 * @param lat - The latitude of the location
 * @param lon - The latitude of the location
 * @param radius - the radius of searching.
 * @returns {Promise&lt;place>} array that store the suggested place
 * @returns {null} error to request overpass
 */

async function fetchSuggestedPLaces(lat, lon, radius,) {
    // Construct the Overpass query using overpass_QL
    const overpassQuery = `[out:json];
    (
     node(around:${radius},${lat},${lon})["name"]["tourism"="museum"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="gallery"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="attraction"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="artwork"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="viewpoint"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="zoo"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="aquarium"];
     node(around:${radius},${lat},${lon})["name"]["tourism"="theme_park"];
     node(around:${radius},${lat},${lon})["name"]["website"]["amenity"="restaurant"];
     node(around:${radius},${lat},${lon})["name"]["website"]["amenity"="fast_food"];
    );
    out body;
    >;
    out center qt;`;

    // Encode the query for the URL
    const encodedQuery = encodeURIComponent(overpassQuery);

    // Construct the URL for the request
    const apiUrl = `${OVERPASS_API_URL}${encodedQuery}`;

    try {
        // Make the HTTP request using fetch
        const response = await fetch(apiUrl);
        const data = await response.json();

        // Directly return the mapped array with the desired information
        return data.elements.map(element => {
            //restaurant and fast food have a different object structure from other place type to add the type of cuisine
            // Check if the amenity is a restaurant and extract cuisine type if available
            if(element.tags &amp;&amp; (element.tags.amenity === 'restaurant' || element.tags.amenity === 'fast_food') &amp;&amp; element.tags.cuisine){
                return {
                    //structure of the place's object (restaurant and fast food)
                    name: element.tags &amp;&amp; element.tags.name ? element.tags.name : 'N/A', // if the value not found put 'N/A'
                    latitude: element.lat,
                    longitude: element.lon,
                    website: element.tags &amp;&amp; element.tags.website ? element.tags.website : 'N/A',
                    type: element.tags &amp;&amp; (element.tags.amenity || element.tags.tourism) ? (element.tags.amenity || element.tags.tourism) : 'N/A',
                    cuisine :  element.tags &amp;&amp; element.tags.cuisine ? element.tags.cuisine : 'N/A'
                };

            }
            else {
                return {
                    //structure of the place's object
                    name: element.tags &amp;&amp; element.tags.name ? element.tags.name : 'N/A',
                    latitude: element.lat,
                    longitude: element.lon,
                    website: element.tags &amp;&amp; element.tags.website ? element.tags.website : 'N/A',
                    type: element.tags &amp;&amp; (element.tags.amenity || element.tags.tourism) ? (element.tags.amenity || element.tags.tourism) : 'N/A'
                };

            }
        });
    } catch (error) {
        console.error("Error fetching data:", error);
        // In case of an error return null
        return null ;
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Autocomplete.html">Autocomplete</a></li></ul><h3>Global</h3><ul><li><a href="global.html#NOMINATIM_API_URL">NOMINATIM_API_URL</a></li><li><a href="global.html#OVERPASS_API_URL">OVERPASS_API_URL</a></li><li><a href="global.html#TILE_LAYER_URL">TILE_LAYER_URL</a></li><li><a href="global.html#addPlaceMaker">addPlaceMaker</a></li><li><a href="global.html#betweenDates">betweenDates</a></li><li><a href="global.html#createAccordion">createAccordion</a></li><li><a href="global.html#endDate">endDate</a></li><li><a href="global.html#fetchNominatim">fetchNominatim</a></li><li><a href="global.html#fetchSuggestedPLaces">fetchSuggestedPLaces</a></li><li><a href="global.html#getDataFromLocalStorage">getDataFromLocalStorage</a></li><li><a href="global.html#handleAddAttractionButtonClick">handleAddAttractionButtonClick</a></li><li><a href="global.html#handleCancAttractionClick">handleCancAttractionClick</a></li><li><a href="global.html#initializeDraggableElement">initializeDraggableElement</a></li><li><a href="global.html#initializeDroppableForm">initializeDroppableForm</a></li><li><a href="global.html#initilizeAccordion">initilizeAccordion</a></li><li><a href="global.html#loadMap">loadMap</a></li><li><a href="global.html#removeMarkers">removeMarkers</a></li><li><a href="global.html#startDate">startDate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Dec 12 2023 00:10:02 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
